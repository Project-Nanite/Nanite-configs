#!/bin/bash

# Firefox ESR Customization for Nanite Linux
# Configures homepage, bookmarks, and settings like Kali Linux

set -e

echo "I: Customizing Firefox ESR for Nanite Linux..."

# Create Firefox default profile structure
FIREFOX_DIR="/etc/firefox-esr"
PROFILE_DIR="$FIREFOX_DIR/profile"
mkdir -p "$PROFILE_DIR"

# Create user.js for default settings
cat > "$PROFILE_DIR/user.js" << 'EOF'
// Nanite Linux Firefox ESR Configuration
// Homepage and startup settings
user_pref("browser.startup.homepage", "https://nanite.software|https://yashbhangale.github.io");
user_pref("browser.startup.page", 1);
user_pref("browser.newtabpage.enabled", true);

// Disable recommended stories and pocket
user_pref("browser.newtabpage.activity-stream.feeds.section.topstories", false);
user_pref("browser.newtabpage.activity-stream.showSponsored", false);
user_pref("browser.newtabpage.activity-stream.showSponsoredTopSites", false);
user_pref("extensions.pocket.enabled", false);

// Privacy and security enhancements
user_pref("privacy.trackingprotection.enabled", true);
user_pref("browser.safebrowsing.malware.enabled", true);
user_pref("browser.safebrowsing.phishing.enabled", true);

// Custom new tab page
user_pref("browser.newtabpage.activity-stream.feeds.topsites", true);
user_pref("browser.newtabpage.activity-stream.topSitesRows", 2);
EOF

# Create bookmarks.html with AI tools
cat > "$PROFILE_DIR/bookmarks.html" << 'EOF'
<!DOCTYPE NETSCAPE-Bookmark-file-1>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>Nanite Linux Bookmarks</TITLE>
<H1>Bookmarks Menu</H1>

<DL><p>
    <DT><H3 ADD_DATE="1640995200" LAST_MODIFIED="1640995200" PERSONAL_TOOLBAR_FOLDER="true">Bookmarks Toolbar</H3>
    <DL><p>
        <DT><A HREF="https://nanite.software" ADD_DATE="1640995200" LAST_MODIFIED="1640995200">Nanite Linux</A>
        <DT><A HREF="https://yashbhangale.github.io" ADD_DATE="1640995200" LAST_MODIFIED="1640995200">Yash Bhangale</A>
        
        <DT><H3 ADD_DATE="1640995200" LAST_MODIFIED="1640995200">AI Tools</H3>
        <DL><p>
            <DT><A HREF="https://chat.openai.com" ADD_DATE="1640995200">ChatGPT</A>
            <DT><A HREF="https://claude.ai" ADD_DATE="1640995200">Claude AI</A>
            <DT><A HREF="https://gemini.google.com" ADD_DATE="1640995200">Google Gemini</A>
            <DT><A HREF="https://copilot.microsoft.com" ADD_DATE="1640995200">Microsoft Copilot</A>
            <DT><A HREF="https://perplexity.ai" ADD_DATE="1640995200">Perplexity AI</A>
            <DT><A HREF="https://you.com" ADD_DATE="1640995200">You.com</A>
        </DL><p>
    </DL><p>
</DL>
EOF

# Create autoconfig for system-wide deployment
cat > "$FIREFOX_DIR/autoconfig.js" << 'EOF'
pref("general.config.filename", "nanite-firefox.cfg");
pref("general.config.obscure_value", 0);
EOF

cat > "$FIREFOX_DIR/nanite-firefox.cfg" << 'EOF'
// Nanite Linux Firefox Configuration
lockPref("browser.startup.homepage", "https://nanite.software|https://yashbhangale.github.io");
lockPref("browser.newtabpage.activity-stream.feeds.section.topstories", false);
lockPref("extensions.pocket.enabled", false);
EOF

# Set permissions
chmod 644 "$PROFILE_DIR/user.js"
chmod 644 "$PROFILE_DIR/bookmarks.html"
chmod 644 "$FIREFOX_DIR/autoconfig.js"
chmod 644 "$FIREFOX_DIR/nanite-firefox.cfg"

echo "I: Firefox ESR customization completed!"
