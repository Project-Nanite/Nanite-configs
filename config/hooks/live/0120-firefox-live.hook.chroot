#!/bin/bash

# Firefox Customization for Live Environment
# Applies Firefox settings for the live user

set -e

echo "I: Configuring Firefox for live environment..."

LIVE_USER="nanite"
LIVE_HOME="/home/$LIVE_USER"
FIREFOX_DIR="$LIVE_HOME/.mozilla/firefox"

# Create Firefox directory for live user
mkdir -p "$FIREFOX_DIR"

# Create profiles.ini
cat > "$FIREFOX_DIR/profiles.ini" << 'EOF'
[Install4F96D1932A9F858E]
Default=default-release
Locked=1

[Profile0]
Name=default
IsRelative=1
Path=default-release
Default=1

[General]
StartWithLastProfile=1
Version=2
EOF

# Create profile directory
PROFILE_PATH="$FIREFOX_DIR/default-release"
mkdir -p "$PROFILE_PATH"

# Create user preferences for live environment
cat > "$PROFILE_PATH/user.js" << 'EOF'
// Nanite Linux Live Environment Firefox Configuration
user_pref("browser.startup.homepage", "https://nanite.software|https://yashbhangale.github.io");
user_pref("browser.startup.page", 1);
user_pref("browser.newtabpage.enabled", true);

// Disable unwanted features
user_pref("browser.newtabpage.activity-stream.feeds.section.topstories", false);
user_pref("browser.newtabpage.activity-stream.showSponsored", false);
user_pref("browser.newtabpage.activity-stream.showSponsoredTopSites", false);
user_pref("extensions.pocket.enabled", false);

// Custom top sites
user_pref("browser.newtabpage.activity-stream.default.sites", "https://nanite.software,https://yashbhangale.github.io,https://chat.openai.com,https://claude.ai");

// Privacy settings
user_pref("privacy.trackingprotection.enabled", true);
user_pref("datareporting.healthreport.uploadEnabled", false);
user_pref("toolkit.telemetry.enabled", false);

// Live environment optimizations
user_pref("browser.sessionstore.resume_from_crash", false);
user_pref("browser.sessionstore.restore_on_demand", false);
user_pref("browser.cache.disk.enable", false);
user_pref("browser.cache.memory.enable", true);
EOF

# Create bookmarks for live user
cat > "$PROFILE_PATH/bookmarks.html" << 'EOF'
<!DOCTYPE NETSCAPE-Bookmark-file-1>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>Nanite Linux Bookmarks</TITLE>
<H1>Bookmarks Menu</H1>

<DL><p>
    <DT><H3 ADD_DATE="1640995200" LAST_MODIFIED="1640995200" PERSONAL_TOOLBAR_FOLDER="true">Bookmarks Toolbar</H3>
    <DL><p>
        <DT><A HREF="https://nanite.software" ADD_DATE="1640995200">üè† Nanite Linux</A>
        <DT><A HREF="https://yashbhangale.github.io" ADD_DATE="1640995200">üë®‚Äçüíª Yash Portfolio</A>
        
        <DT><H3 ADD_DATE="1640995200" LAST_MODIFIED="1640995200">ü§ñ AI Tools</H3>
        <DL><p>
            <DT><A HREF="https://chat.openai.com" ADD_DATE="1640995200">ChatGPT</A>
            <DT><A HREF="https://claude.ai" ADD_DATE="1640995200">Claude AI</A>
            <DT><A HREF="https://gemini.google.com" ADD_DATE="1640995200">Gemini</A>
            <DT><A HREF="https://copilot.microsoft.com" ADD_DATE="1640995200">Copilot</A>
            <DT><A HREF="https://perplexity.ai" ADD_DATE="1640995200">Perplexity</A>
            <DT><A HREF="https://you.com" ADD_DATE="1640995200">You.com</A>
            <DT><A HREF="https://huggingface.co/chat" ADD_DATE="1640995200">HuggingFace</A>
        </DL><p>
        
        <DT><H3 ADD_DATE="1640995200" LAST_MODIFIED="1640995200">üîß Dev Tools</H3>
        <DL><p>
            <DT><A HREF="https://github.com" ADD_DATE="1640995200">GitHub</A>
            <DT><A HREF="https://stackoverflow.com" ADD_DATE="1640995200">Stack Overflow</A>
            <DT><A HREF="https://developer.mozilla.org" ADD_DATE="1640995200">MDN Docs</A>
        </DL><p>
    </DL><p>
</DL>
EOF

# Set proper ownership and permissions
chown -R $LIVE_USER:$LIVE_USER "$FIREFOX_DIR"
chmod -R 755 "$FIREFOX_DIR"
chmod 644 "$FIREFOX_DIR/profiles.ini"
chmod 644 "$PROFILE_PATH/user.js"
chmod 644 "$PROFILE_PATH/bookmarks.html"

echo "I: Firefox live environment configuration completed!"
